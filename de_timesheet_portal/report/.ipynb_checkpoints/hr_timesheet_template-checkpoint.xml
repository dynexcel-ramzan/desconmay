<?xml version="1.0" encoding="utf-8"?>
<odoo>
<template id="hr_timesheet_report">
    <t t-call="web.html_container">
    <t t-call="web.external_layout">
        <t t-set="company" t-value="request.env['hr.employee'].sudo().search([('emp_number','=',employee_timesheet['employee_no'])], limit=1).company_id"/> 
        <div class="page">
            <div class="oe_structure"/>
            
            <div  style="margin-left: 800px; max-width: 250px;height: 20px;">
               <strong>Printed On:</strong>
               <span  t-esc="datetime.datetime.strptime(str(datetime.datetime.now()+ relativedelta(hours =+ 5)), '%Y-%m-%d %H:%M:%S.%f').strftime('%d-%b-%y %H:%M %p')"/>
            </div>
            
            <div  style="position: relative; max-width: 400px;">
               <strong>Timesheet Report</strong> <br/>
               <table class="table table-sm table-striped table-bordered" >
                <tr> 
                </tr>   
            </table>
            </div>
            <table class="table table-sm table-striped table-bordered">
                <tr style="height:30%">
                    <th  align="center">Employee</th>
                    <td  align="center"><span t-esc="employee_timesheet['name']"/></td>
                    <th  align="center">Employee No:</th>
                    <td  align="center"> <span t-esc="employee_timesheet['employee_no']"/></td>
                    <th  align="center">Period:</th>
                    <td  align="center"> 
                         <span t-esc="employee_timesheet['date_from']"/>,  
                        
                        
                         <span t-esc="employee_timesheet['date_to']"/>   
                    </td>
                </tr>
                <tr style="height:30%">
                    <th  align="center">Manager</th>
                    <td  align="center"><span t-esc="employee_timesheet['manager']"/></td>
                    <th  align="center">Department</th>
                    <td  align="center"> <span t-esc="employee_timesheet['department']"/></td>
                    <th  align="center"></th>
                    <td  align="center"></td>
                </tr>

            </table>
            <br/>
            <t t-if='type="sumamry"'>
                <table class="table table-sm table-striped table-bordered">
                    <thead>
                        <tr>
                            <th>DATE</th>
                            <th>PLANNED HOURS</th>
                            <th>WORKED HOURS</th>
                            <th>IDLE HOURS</th>
                        </tr>
                    </thead>
                        <tbody class="attendance_tbody">
                            <t t-foreach="employee_attendance['summary_timesheet_data']" t-as="summary_timesheet">
                                <tr>
                                    <td ><span t-esc="summary_timesheet['date']"/></td>
                                    <td ><span t-esc="summary_timesheet['planned_hrs']"/></td>
                                    <td ><span t-esc="summary_timesheet['worked_hrs']"/></td>
                                    <td ><span t-esc="summary_timesheet['idle_hrs']"/></td>
                                   </tr>
                              </t>
                            
                            <tr>
                                <td >Total</td>
                                <td ><span t-esc="employee_timesheet['tot_planned_hrs']"/></td>
                                <td ><span t-esc="employee_timesheet['tot_worked_hrs']"/></td>
                                <td ><span t-esc="employee_timesheet['tot_idle_hrs']"/></td>
                            </tr>

                        </tbody>
                </table>
             </t>
            <t t-if='type="detail"'>
                <table class="table table-sm table-striped table-bordered">
                    <thead>
                        <tr>
                            <th>DATE</th>
                            <th>PROJECT</th>
                            <th>TASK</th>
                            <th>START TIME</th>
                            <th>END TIME</th>
                            <th>DURATION</th>
                        </tr>
                    </thead>
                        <tbody class="attendance_tbody">
                            <t t-set='ora_line_date' t-value='0'/>
                            <t t-foreach="detail_timesheet_data" t-as="detail_timesheet">
                                <t t-set='total_planned_hrs' t-value='0'/>
                                <t t-set='total_worked_hrs' t-value='0'/>
                                <t t-set='total_idle_hrs' t-value='0'/>
                                <t t-if='ora_line_date!=detail_timesheet.line_date'>
                                    <t t-foreach="request.env['hr.shift.schedule.line'].sudo().search([('employee_id','=',detail_timesheet.employee_id.id),('date','=',ora_line_date),('state','=','posted')])" t-as="shift_line">
                                        <t t-set='total_planned_hrs' t-value='total_planned_hrs+shift_line.first_shift_id.hours_per_day'/>
                                        <t t-set='total_planned_hrs' t-value='total_planned_hrs+shift_line.second_shift_id.hours_per_day'/>
                                    </t> 
                                    <t t-if='total_planned_hrs==0'>
                                        <t t-foreach="request.env['resource.calendar'].sudo().search([('shift_type','=','general')])" t-as="sft_type">
                                        <t t-set='total_planned_hrs' t-value='total_planned_hrs+sft_type.hours_per_day'/>
                                       
                                    </t> 
                                    </t>
                                    
                                    
                                    <t t-set='total_worked_hrs' t-value='total_worked_hrs + detail_timesheet.unit_amount'/>
                                    
                                </t>    
                                <t t-if='ora_line_date!=detail_timesheet.line_date'>
                                    <tr>
                                        <td >Sub-Total</td>
                                        <td >
                                            
                                        </td>
                                        <td ></td>
                                        <td ><span t-esc="round(total_planned_hrs,2)" t-options='{"widget": "float_time"}'/></td>
                                        <td ><span t-esc="round(total_worked_hrs,2)" t-options='{"widget": "float_time"}'/></td>
                                        <td >
                                            <t t-if='(total_planned_hrs-total_worked_hrs)>0'>
                                                <span t-esc="round((total_planned_hrs-total_worked_hrs),2)" t-options='{"widget": "float_time"}'/>
                                            </t>
                                            <t t-if='(total_planned_hrs-total_worked_hrs)<0'>
                                                <span t-esc="0" />
                                            </t>
                                            </td>
                                       </tr>
                                </t>  
                                
                                <t t-set='ora_line_date' t-value='detail_timesheet.line_date'/>
                                
                                <tr>
                                    <td ><span t-esc="detail_timesheet.line_date.strftime('%d-%b-%y)"/></td>
                                    <td >
                                        <span t-esc="detail_timesheet.project_id.name"/>
                                    </td>
                                    <td ><span t-esc="detail_timesheet.task_id.name"/></td>
                                    <td ><span t-esc="detail_timesheet.unit_amount_from" t-options='{"widget": "float_time"}'/></td>
                                    <td ><span t-esc="detail_timesheet.unit_amount_to" t-options='{"widget": "float_time"}'/></td>
                                    <td ><span t-esc="detail_timesheet.unit_amount" t-options='{"widget": "float_time"}'/></td>
                                </tr>
                                
                              </t>

                        </tbody>
                </table>
             </t>
            
          </div>
    </t>
    </t>
</template>
    
     <template id="timesheet_report">
       <t t-call="web.html_container">
            <t t-foreach="timesheet_data" t-as="employee_timesheet"> 
               <t t-call="de_hr_attendance_report.hr_timesheet_report"/>
           </t>
       </t>
   </template>
    
    

    
</odoo>